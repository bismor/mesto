(()=>{"use strict";class e{constructor(e){this._popupElement=document.querySelector(e),this.close=this.close.bind(this)}open(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose=e=>{"Escape"===e.key&&this.close()};_handleOverlay=e=>{e.target.classList.contains("popup_opened")&&this.close()};setEventListeners(){this._popupElement.addEventListener("mousedown",this._handleOverlay),this._popupElement.querySelector(".popup__close").addEventListener("mousedown",this.close)}}class t{#e;#t;constructor(e,t,s,o,r,i,n){this._name=e.name,this._link=e.link,this._id=e._id,this._templateSelector=t,this._handleCardClick=s,this._element=this._getTemplate(),this._cardPict=this._element.querySelector(".mesto__img"),this._likeScore=this._element.querySelector(".like__score"),this.#e=e.owner._id,this.#t=n,this._handleDeleteClick=o,this._handleAddLikeCard=r,this._handleRemoveLikeCard=i,this._cardSection=this._element.querySelector(".mesto__element"),this._likeButton=this._element.querySelector(".mesto__like"),this.setLikes(e.likes)}_getTemplate(){return document.querySelector(this._templateSelector).content.cloneNode(!0)}_setOpenApprovalDelete=()=>{this._handleDeleteClick(this._setOnDeleteClick)};_updateLikes=()=>{this._checkFindUserByID(this._likes,this.#t)?this._likeButton.classList.add("mesto__like-active"):this._likeButton.classList.remove("mesto__like-active"),this._likeScore.textContent=this._likes.length};_checkFindUserByID=(e,t)=>e.find((e=>e._id===t));_changeLikeClick=()=>{this._checkFindUserByID(this._likes,this.#t)?this._handleRemoveLikeCard(this._id,this.setLikes):this._handleAddLikeCard(this._id,this.setLikes)};_setOnOpenPicture=()=>{this._handleCardClick(this._link,this._name)};setEventListeners(){this.#e===this.#t&&this._element.querySelector(".mesto__delete").addEventListener("click",this._setOpenApprovalDelete),this._element.querySelector(".mesto__like").addEventListener("click",this._changeLikeClick),this._cardPict.addEventListener("click",this._setOnOpenPicture)}setLikes=e=>{this._likes=e,this._updateLikes()};render=()=>(this._cardPict.alt=this._name,this._cardPict.src=this._link,this._cardSection.id=`card${this._id}`,this._likeScore.textContent=this._likes.length,this._element.querySelector(".mesto__title").textContent=this._name,this.#e!==this.#t&&this._element.querySelector(".mesto__delete").remove(),this.setEventListeners(),this._element)}const s={sectionSelector:".popup__section",inputSelector:".popup__text",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:".popup__input-error",errorClass:".popup__button_inactive",popupTextTypeError:"popup__text-type-error",formInputError:"popup__input-error_active"};class o{constructor(e,t){this._selectors=e,this._form=t,this._buttonElement=t.querySelector(e.submitButtonSelector),this._inputList=Array.from(t.querySelectorAll(e.inputSelector))}_hasInvalidInput=()=>this._inputList.some((e=>!e.validity.valid));_showInputError(e,t){e.classList.add(this._selectors.popupTextTypeError),this._errorElement.classList.add(this._selectors.formInputError),this._errorElement.textContent=t}_hideInputError(e){e.classList.remove(this._selectors.popupTextTypeError),this._errorElement.classList.remove(this._selectors.formInputError),this._errorElement.textContent=""}_toggleButtonState=()=>{this._hasInvalidInput()?(this._buttonElement.setAttribute("disabled",!0),this._buttonElement.classList.add(this._selectors.inactiveButtonClass)):(this._buttonElement.removeAttribute("disabled"),this._buttonElement.classList.remove(this._selectors.inactiveButtonClass))};_checkInputValidity(e){this._isValid=e.validity.valid,this._formSection=e.closest(this._selectors.sectionSelector),this._errorElement=this._formSection.querySelector(this._selectors.inputErrorClass),this._isValid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_setEventListeners(){const e=this._form;this._toggleButtonState(),e.addEventListener("reset",(()=>{setTimeout((()=>{this._toggleButtonState()}),0)})),this._inputList.forEach((t=>{e.addEventListener("input",(()=>{this._checkInputValidity(t),this._toggleButtonState()}))}))}enableValidation=()=>{this._setEventListeners()}}class r{constructor(e,t){this._renderer=e,this._container=document.querySelector(t)}addItem(e){this._container.append(e)}beforeaddItem(e){this._container.prepend(e)}renderItems(e){e.forEach(this._renderer)}}class i extends e{constructor(e,t){super(e),this._callBackSumbit=t,this._popupForm=this._popupElement.querySelector(".popup__form"),this._handleSumbit=this._handleSumbit.bind(this),this._inputList=this._popupForm.querySelectorAll(".popup__text")}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}_handleSumbit(e){e.preventDefault(),this._popupElement.querySelector(".popup__button").textContent="Подождите..",this._callBackSumbit(this._getInputValues())}close(){super.close(),this._popupForm.reset(),this._popupElement.querySelector(".popup__button").textContent="Сохранить"}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",this._handleSumbit)}setFormValues(e){this._inputList.forEach((t=>{t.value=e[t.name]}))}}const n=document.querySelector(".cardPopup"),c=document.querySelector(".profilePopup"),a=document.querySelector(".changeAvatar"),l=document.querySelector(".profile__buttonpict"),h=document.querySelector(".profile__avatar"),u=document.querySelector(".profile__button"),p=document.querySelector(".button"),_=n.querySelector(".popup__name"),d=document.querySelector(".changeAvatar").querySelector(".popup__job"),m=n.querySelector(".popup__job"),v=new o(s,c),S=new o(s,n),E=new o(s,a);v.enableValidation(),S.enableValidation(),E.enableValidation();const f=new class extends e{constructor(e){super(e),this._popupPictCont=this._popupElement.querySelector(".popup__picture"),this._pictureName=this._popupPictCont.querySelector(".popup__subname"),this._popupScreen=this._popupPictCont.querySelector(".popup__screen")}open(e,t){super.open(),this._pictureName.textContent=e,this._popupScreen.src=t,this._popupScreen.alt=e}close(){super.close(),this._popupScreen.src=null,this._popupScreen.alt=null}}(".imagePopup");f.setEventListeners();const k=new i(".profilePopup",(function(e){C.changeProfileInfo(e).then((()=>{k.close(),q.setUserInfo(e)})).catch((e=>{console.log(e)}))}));k.setEventListeners();const y=new i(".cardPopup",(function(){const e=_.value,t=m.value;C.addCard({name:e,link:t}).then((e=>{const t=g(e,e.owner._id);I.beforeaddItem(t),y.close()})).catch((e=>{console.log(e)}))}));y.setEventListeners();const L=new i(".changeAvatar",(function(){const e=d.value;C.changeProfileAvatar(e).then((()=>{L.close(),h.src=e}))}));L.setEventListeners();const b=new class extends e{constructor(e,t){super(e),this._callBackSumbit=t,this._popupForm=this._popupElement.querySelector(".popup__form"),this._handleSumbit=this._handleSumbit.bind(this)}_getInputValues(){return this._popupElement.querySelector(".popup__text").value}_handleSumbit(e){e.preventDefault(),this._popupElement.querySelector(".popup__button").textContent="Подождите..",this._callBackSumbit(this._getInputValues())}close(){super.close(),this._popupForm.reset(),this._popupElement.querySelector(".popup__button").textContent="Сохранить"}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",this._handleSumbit)}setFormValues(e){const t=this._popupElement.querySelector(".popup__text");t.value=e[t.name]}}(".deleteCardPopup",(function(e){C.deleteCardServer(e).then((()=>{var t;b.close(),t=`#card${e}`,document.querySelector(t)?.remove()})).catch((e=>{console.log(e)}))}));b.setEventListeners();const C=new class{constructor(){this._authorization="2c0e8e40-9bc8-4cbb-b338-6dd82b568a54",this._headers={authorization:this._authorization,"Content-Type":"Application/JSON"}}_resToJSON(e){return e.ok?e.json():Promise.reject("Произошла ошибка")}getInitialCards(){return fetch("https://mesto.nomoreparties.co/v1/cohort-57/cards",{headers:this._headers}).then(this._resToJSON)}getProfileInformation(){return fetch("https://nomoreparties.co/v1/cohort-57/users/me",{headers:this._headers}).then(this._resToJSON)}addCard(e){return fetch("https://mesto.nomoreparties.co/v1/cohort-57/cards",{method:"POST",body:JSON.stringify(e),headers:this._headers}).then(this._resToJSON)}changeProfileInfo(e){return fetch("https://mesto.nomoreparties.co/v1/cohort-57/users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._resToJSON)}changeProfileAvatar(e){return fetch("https://mesto.nomoreparties.co/v1/cohort-57/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e}),headers:{authorization:this._authorization,"Content-Type":"Application/JSON"}}).then(this._resToJSON)}deleteCardServer(e){return fetch("https://mesto.nomoreparties.co/v1/cohort-57/cards/"+e,{method:"DELETE",headers:this._headers}).then(this._resToJSON)}addLikeCard(e){return fetch("https://mesto.nomoreparties.co/v1/cohort-57/cards/"+e+"/likes",{method:"PUT",headers:this._headers}).then(this._resToJSON)}removeLikeCard(e){return fetch("https://mesto.nomoreparties.co/v1/cohort-57/cards/"+e+"/likes",{method:"DELETE",headers:this._headers}).then(this._resToJSON)}};let I;function g(e,s){return new t(e,".mesto__template",((e,t)=>{f.open(t,e)}),(()=>{b.open(),b.setFormValues({payload:e._id})}),P,T,s).render()}C.getInitialCards(),Promise.all([C.getInitialCards(),C.getProfileInformation()]).then((e=>{const[t,s]=e;q.setUserInfo(s),q.setUserAvatar(s.avatar),I=new r((e=>{const t=g(e,s._id);I.addItem(t)}),".mesto__ul"),I.renderItems(t)})).catch((e=>{console.log(e)}));const q=new class{constructor({userName:e,userinfo:t,useravatar:s}){this._userName=document.querySelector(e),this._userInfo=document.querySelector(t),this._userAvatar=document.querySelector(s)}getUserInfo(){const e={};return e.name=this._userName.textContent,e.about=this._userInfo.textContent,e}setUserInfo(e){this._userName.textContent=e.name,this._userInfo.textContent=e.about}setUserAvatar(e){this._userAvatar.src=e}}({userName:".profile__title",userinfo:".profile__subtitle",useravatar:".profile__avatar"});function P(e,t){C.addLikeCard(e).then((e=>{t(e.likes)})).catch((e=>{console.log(e)}))}function T(e,t){C.removeLikeCard(e).then((e=>{t(e.likes)})).catch((e=>{console.log(e)}))}u.addEventListener("click",(function(){const e=q.getUserInfo();k.open(),k.setFormValues(e)})),p.addEventListener("click",(function(){y.open()})),l.addEventListener("click",(function(){L.open()}))})();
//# sourceMappingURL=main.js.map